#!/bin/bash

#
# References:
#   - https://github.com/yannbertrand/macos-defaults
#   - https://github.com/mathiasbynens/dotfiles
#   - https://github.com/br3ndonland/dotfiles
############################################################

#
# General
############################################################
# Date & Time
defaults write NSGlobalDomain AppleICUForce24HourTime -bool true # Set 24-hour time

# Language & Region
defaults write NSGlobalDomain AppleTemperatureUnit -string "Celsius"
defaults write NSGlobalDomain AppleMeasurementUnits -string "Centimeters"
defaults write NSGlobalDomain AppleMetricUnits -bool true
defaults write NSGlobalDomain AppleICUDateFormatStrings -dict 1 "y-MM-dd" # Date format

#
# Appearance
############################################################
# Enable dark mode
defaults write NSGlobalDomain AppleInterfaceStyle -string "Dark" # Dark / Light
defaults write NSGlobalDomain NSGlassDiffusionSetting -int 0     # 0: Clear / 1: Tinted
if defaults read NSGlobalDomain AppleInterfaceStyleSwitchesAutomatically 2>/dev/null; then
  # Remove theme auto
  defaults delete NSGlobalDomain AppleInterfaceStyleSwitchesAutomatically
fi

# Show scroll bars
defaults write NSGlobalDomain AppleShowScrollBars -string "WhenScrolling" # Automatic / Always / WhenScrolling

# Sidebar icon size
defaults write NSGlobalDomain NSTableViewDefaultSizeMode -int 1 # 1: Small / 2: Medium / 3: Large

#
# Menu Bar
############################################################
defaults write com.apple.menuextra.clock ShowSeconds -bool true # Enable seconds

#
# Lock Screen
############################################################
defaults write com.apple.screensaver askForPassword -int 1
defaults write com.apple.screensaver askForPasswordDelay -int 0

#
# Keyboard
############################################################
# Text Input: disable annoying completions
defaults write NSGlobalDomain NSAutomaticCapitalizationEnabled -bool false
defaults write NSGlobalDomain NSAutomaticDashSubstitutionEnabled -bool false
defaults write NSGlobalDomain NSAutomaticPeriodSubstitutionEnabled -bool false
defaults write NSGlobalDomain NSAutomaticQuoteSubstitutionEnabled -bool false
defaults write NSGlobalDomain NSAutomaticSpellingCorrectionEnabled -bool false

#
# Finder
############################################################
# Show icons for hard drives, servers, and removable media on the desktop
defaults write com.apple.finder ShowExternalHardDrivesOnDesktop -bool true
defaults write com.apple.finder ShowHardDrivesOnDesktop -bool false
defaults write com.apple.finder ShowMountedServersOnDesktop -bool true
defaults write com.apple.finder ShowRemovableMediaOnDesktop -bool true

defaults write com.apple.finder FXPreferredViewStyle -string "clmv" # Column: clmv / List: Nlsv / Gallery: glyv
defaults write com.apple.finder AppleShowAllFiles -bool true        # Show hidden files by default
defaults write com.apple.finder ShowStatusBar -bool true
defaults write com.apple.finder ShowPathbar -bool true

# Avoid creating .DS_Store files on network or USB volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

# Enable spring loading for directories
defaults write NSGlobalDomain com.apple.springing.enabled -bool true

# Keep folders on top
defaults write com.apple.finder _FXSortFoldersFirst -bool true
defaults write com.apple.finder _FXSortFoldersFirstOnDesktop -bool true

# Save to disk by default, instead of iCloud
defaults write NSGlobalDomain NSDocumentSaveNewDocumentsToCloud -bool false

# Show the ~/Library folder
chflags nohidden ~/Library

#
# Desktop & Dock
############################################################
dock_app_add() {
  local app_path="$1"

  if [ ! -e "$app_path" ]; then
    echo -e "App not found: $app_path"
    return 1
  fi

  echo -e "Adding app: $(basename "$app_path")"

  defaults write com.apple.dock persistent-apps -array-add "<dict>
    <key>tile-data</key>
    <dict>
      <key>file-data</key>
      <dict>
        <key>_CFURLString</key>
        <string>file://$app_path</string>
        <key>_CFURLStringType</key>
        <integer>15</integer>
      </dict>
    </dict>
  </dict>"
}

# Remove all dock apps
read -p "Clean dock applications? [y/N]" -n 1
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
  defaults write com.apple.dock persistent-apps -array

  dock_app_add "/System/Applications/Apps.app/"
  dock_app_add "/System/Applications/App Store.app/"
  dock_app_add "/System/Applications/System Settings.app/"
  dock_app_add "/Applications/Firefox.app/"
fi

# Size of dock icons
defaults write com.apple.dock tilesize -int 34

# Magnification
defaults write com.apple.dock magnification -bool true
defaults write com.apple.dock largesize -int 44

# Window title bar double-click action
defaults write NSGlobalDomain AppleActionOnDoubleClick -string "Maximize" # Fill / Maximize / Minimize

defaults write com.apple.dock orientation -string "left" # bottom / left / right
defaults write com.apple.dock mineffect -string "genie"  # genie / scale
defaults write com.apple.dock minimize-to-application -bool true
defaults write com.apple.dock autohide -bool true
defaults write com.apple.dock show-recents -bool false

# Animate opening applications
defaults write com.apple.dock launchanim -bool true

# Show indicators for open applications
defaults write com.apple.dock show-process-indicators -bool true

# Show Widgets (disable)
defaults write com.apple.WindowManager StandardHideWidgets -bool true     # On Desktop
defaults write com.apple.WindowManager StageManagerHideWidgets -bool true # In Stage Manager

# iPhone Widgets (disable)
defaults write com.apple.chronod remoteWidgetsEnabled -bool false
defaults write com.apple.chronod effectiveRemoteWidgetsEnabled -bool false

# Dim widgets on desktop
defaults write com.apple.widgets widgetAppearance -int 0 # 0: Always / 1: Never / 2: Auto

# Prefer tabs when opening documents
defaults write NSGlobalDomain AppleWindowTabbingMode -string "always" # always / fullscreen / manual

# Mission Control - Auto rearrange Spaces based on most recent use
defaults write com.apple.dock mru-spaces -bool false

# Mission Control - Group windows by application
defaults write com.apple.dock expose-group-by-app -bool true

# Mission Control - Hot Corners
# Available values:
#  0: no-op               |   5: Start Screen Saver   |  11: Launchpad
#  2: Mission Control     |   6: Disable Screen Saver |  12: Notification Center
#  3: Application Windows |   7: Dashboard            |  13: Lock Screen
#  4: Desktop             |  10: Put Display to Sleep |
defaults write com.apple.dock wvous-bl-corner -int 2 # Bottom left
defaults write com.apple.dock wvous-bl-modifier -int 0
defaults write com.apple.dock wvous-br-corner -int 2 # Bottom right
defaults write com.apple.dock wvous-br-modifier -int 0
defaults write com.apple.dock wvous-tl-corner -int 10 # Top Left
defaults write com.apple.dock wvous-tl-modifier -int 0
defaults write com.apple.dock wvous-tr-corner -int 12 # Top Right
defaults write com.apple.dock wvous-tr-modifier -int 0

#
# Restart affected applications
############################################################
for app in "Activity Monitor" \
  "Address Book" \
  "Calendar" \
  "cfprefsd" \
  "Contacts" \
  "Dock" \
  "Finder" \
  "Mail" \
  "Messages" \
  "Opera" \
  "Photos" \
  "Safari" \
  "SystemUIServer" \
  "Terminal"; do
  killall "${app}" &>/dev/null
done
echo "Some of these changes require a logout/restart to take effect."
